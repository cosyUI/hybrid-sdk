!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.WYAJSBridge=t()}(this,function(){"use strict";function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}var i=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=arguments,n=1;n<arguments.length;n++){var o=t[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}();var o=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=t.throwError;if(Object.defineProperty(this,"throwError",{value:n||function(e){console.error(e)}}),"object"!==(void 0===e?"undefined":s(e))||e instanceof r||e.__events__||e.__listeners__||e.on||e.off||e.emit)return this.throwError("[wya-ps]: 不符合观察条件，请删除以下对象.\n\t\t\t\t\n__events__\n__listeners__\non\noff\nemit\n\t\t\t"),!1;for(var o in Object.defineProperty(this,"__events__",{value:{}}),Object.defineProperty(this,"__listeners__",{value:[]}),e)this[o]=e[o]}return n(r,[{key:"on",value:function(e,t){if("object"===(void 0===e?"undefined":s(e)))for(key in e)e.hasOwnProperty(key)&&"function"==typeof e[key]&&this.on(key,e[key]);else"string"==typeof e&&"function"==typeof t?(this.__events__[e]||(this.__events__[e]=[]),this.__events__[e].push(t)):"function"==typeof e&&this.__listeners__.push(e);return this}},{key:"off",value:function(e,t){return"string"!=typeof e||t?"string"==typeof e&&this.__events__[e]&&t?this.__events__[e]=this.__events__[e].filter(function(e){return e!==t}):void 0===(void 0===e?"undefined":s(e))&&(this.__listeners__=[]):delete this.__events__[e],this}},{key:"once",value:function(n,o){var r=this;if("string"==typeof n&&(!this.__events__[n]||0===this.__events__[n].length)){var i=!1;this.on(n,function e(t){r.off(n,e),i||(i=!0,o.call(r,t))})}return this}},{key:"emit",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(t instanceof Array||"object"!==(void 0===t?"undefined":s(t))||t.event)return this.throwError("[wya-ps]: "+e+"事件 - 回调参数必须是对象, 且不能让带event关键字"),this;if("string"==typeof e&&this.__events__.hasOwnProperty(e)&&this.__events__[e]instanceof Array)for(var n=0;this.__events__[e]&&n<this.__events__[e].length&&!1!==this.__events__[e][n].call(this,t);n++);for(var o=0;o<this.__listeners__.length&&!1!==this.__listeners__[o].call(this,i({},t,{event:e}));o++);return this}}]),r}();t.default=o});e(i);var n=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.EventStore=void 0;var n,o=(n=i)&&n.__esModule?n:{default:n};t.EventStore=o.default});e(n);var s=n.EventStore,a=function(e,t){c("_error_",e),t&&t({status:0,msg:e})},c=function(e,t){var n;"function"==typeof document.CustomEvent?n=new document.CustomEvent(e,{bubbles:!0,cancelable:!0}):"function"==typeof document.createEvent&&(n=document.createEvent("Event")).initEvent(e,!0,!0),t&&n&&(n.data=t),n?window.dispatchEvent(n):console.error("Bridge Error: dispatchEvent")};return new(function(){function o(){var e,t,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n="1.0.0",(t="version")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,this.store={},this.count=0,this.source=new s({},{throwError:a}),this.initCount=0,this.waitEmit=[]}var e,t,n;return e=o,(t=[{key:"_send",value:function(t,n){(this.store[t]||{}).eventName;setTimeout(function(){var e=document.createElement("iframe");e.src="command://".concat(n,"?id=").concat(t),e.style.display="none",document.body.appendChild(e),setTimeout(function(){e.parentNode.removeChild(e)},300)},0)}},{key:"getParam",value:function(e){return(this.store[e]||{}).params}},{key:"invoke",value:function(n,i){var s=this;return new Promise(function(o,r){if(n){i=i?decodeURIComponent(JSON.stringify(i)):"";var e=s.count++;s.store[e]={params:i,eventName:"".concat(n,"__").concat(e)};var t=s.store[e].eventName;s.source.once(t,function(e){var t=e.data,n=e.id;1==e.status?o(t):r(t),delete s.store[n]}),0===s.initCount?s.waitEmit.push(s._send.bind(s,e,n)):s._send(e,n)}else a("scheme 方法名必传",r)})}},{key:"addEventListener",value:function(e,t){for(var n=arguments,o=arguments.length,r=new Array(2<o?o-2:0),i=2;i<o;i++)r[i-2]=n[i];var s=("object"===u(r[0])?r[0].success:r[0])||function(){},a=("object"===u(r[1])?r[0].fail:r[1])||function(){};this.source[e](t,function(e){var t=e.data;e.id;1==e.status?s(t):a(t)})}},{key:"on",value:function(e){for(var t=arguments,n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=t[r];this.addEventListener.apply(this,["on",e].concat(o))}},{key:"once",value:function(e){for(var t=arguments,n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=t[r];this.addEventListener.apply(this,["once",e].concat(o))}},{key:"last",value:function(e){var t=arguments;this.off(e);for(var n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=t[r];this.on.apply(this,[e].concat(o))}},{key:"first",value:function(e){var t=arguments;if(this.source.__events__[e]||0===this.source.__events__[e].length){for(var n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=t[r];this.on.apply(this,[e].concat(o))}else{var i="".concat(e,"只执行触发一次绑定");a(i)}}},{key:"emit",value:function(e,t){var n=(this.store[e]||{}).eventName,o=void 0===n?e:n;if("_error_"!==o&&"string"==typeof t)try{t=JSON.parse(t)||{}}catch(e){a("Native端返回格式错误: ".concat(t))}if("object"!==u(t)||void 0!==t.status)switch(o){case"_ready_":if(this.initCount++,1===this.initCount)c(o,t),this.waitEmit.forEach(function(e,t){return e()}),this.waitEmit=[];else{var r="_ready_ 事件, 只允许初始化一次";c(o,{status:0,msg:r}),a(r)}break;case"_error_":a(t);default:this.source.emit(o,t)}else a("Native端返回格式错误: ".concat(t))}},{key:"off",value:function(e){this.source.off(e)}}])&&r(e.prototype,t),n&&r(e,n),o}())});
