!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.WYAJSBridge=e()}(this,function(){"use strict";function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return t(e={exports:{}},e.exports),e.exports}var i=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=arguments,n=1;n<arguments.length;n++){var o=e[n];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}();var o=function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var n=e.throwError;if(Object.defineProperty(this,"throwError",{value:n||function(t){console.error(t)},writable:!0}),"object"!==(void 0===t?"undefined":s(t))||t instanceof r||t.__events__||t.__listeners__||t.on||t.off||t.emit)return this.throwError("[wya-ps]: 不符合观察条件，请删除以下对象.\n\t\t\t\t\n__events__\n__listeners__\non\noff\nemit\n\t\t\t"),!1;for(var o in Object.defineProperty(this,"__events__",{value:{}}),Object.defineProperty(this,"__listeners__",{value:[]}),t)this[o]=t[o]}return n(r,[{key:"on",value:function(t,e){if("object"===(void 0===t?"undefined":s(t)))for(key in t)t.hasOwnProperty(key)&&"function"==typeof t[key]&&this.on(key,t[key]);else"string"==typeof t&&"function"==typeof e?(this.__events__[t]||(this.__events__[t]=[]),this.__events__[t].push(e)):"function"==typeof t&&this.__listeners__.push(t);return this}},{key:"off",value:function(t,e){return"string"!=typeof t||e?"string"==typeof t&&this.__events__[t]&&e?this.__events__[t]=this.__events__[t].filter(function(t){return t!==e}):void 0===(void 0===t?"undefined":s(t))&&(this.__listeners__=[]):delete this.__events__[t],this}},{key:"once",value:function(n,o){var r=this;if("string"==typeof n&&"function"==typeof o){this.on(n,function t(e){r.off(n,t),o.call(r,e)})}return this}},{key:"emit",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e instanceof Array||"object"!==(void 0===e?"undefined":s(e))||e.event)return this.throwError("[wya-ps]: "+t+"事件 - 回调参数必须是对象, 且不能让带event关键字"),this;if("string"==typeof t&&this.__events__.hasOwnProperty(t)&&this.__events__[t]instanceof Array)for(var n=0;this.__events__[t]&&n<this.__events__[t].length&&!1!==this.__events__[t][n].call(this,e);n++);for(var o=0;o<this.__listeners__.length&&!1!==this.__listeners__[o].call(this,i({},e,{event:t}));o++);return this}}]),r}();e.default=o});t(i);var n=e(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.EventStore=void 0;var n,o=(n=i)&&n.__esModule?n:{default:n};e.EventStore=o.default});t(n);var s=n.EventStore,a=function(t,e){c("_error_",t),e&&e({status:0,msg:t})},c=function(t,e){var n;"function"==typeof document.CustomEvent?n=new document.CustomEvent(t,{bubbles:!0,cancelable:!0}):"function"==typeof document.createEvent&&(n=document.createEvent("Event")).initEvent(t,!0,!0),e&&n&&(n.data=e),n?window.dispatchEvent(n):console.error("Bridge Error: dispatchEvent")};return new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.version="1.0.0",this.store={},this.count=0,this.source=new s({},{throwError:a}),this.initCount=0,this.waitEmit=[]}var e,n,o;return e=t,(n=[{key:"_send",value:function(e,n){(this.store[e]||{}).eventName;setTimeout(function(){var t=document.createElement("iframe");t.src="command://".concat(n,"?id=").concat(e),t.style.display="none",document.body.appendChild(t),setTimeout(function(){t.parentNode.removeChild(t)},300)},0)}},{key:"getParam",value:function(t){return(this.store[t]||{}).params}},{key:"invoke",value:function(n,i){var s=this;return new Promise(function(o,r){if(n){i=i?decodeURIComponent(JSON.stringify(i)):"";var t=s.count++;s.store[t]={params:i,eventName:"".concat(n,"__").concat(t)};var e=s.store[t].eventName;s.source.once(e,function(t){var e=t.data,n=t.id;1==t.status?o(e):r(e),delete s.store[n]}),0===s.initCount?s.waitEmit.push(s._send.bind(s,t,n)):s._send(t,n)}else a("scheme 方法名必传",r)})}},{key:"addEventListener",value:function(t,e){for(var n=arguments,o=arguments.length,r=new Array(2<o?o-2:0),i=2;i<o;i++)r[i-2]=n[i];var s=("object"===u(r[0])?r[0].success:r[0])||function(){},a=("object"===u(r[1])?r[0].fail:r[1])||function(){};this.source[t](e,function(t){var e=t.data;t.id;1==t.status?s(e):a(e)})}},{key:"on",value:function(t){for(var e=arguments,n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=e[r];this.addEventListener.apply(this,["on",t].concat(o))}},{key:"once",value:function(t){for(var e=arguments,n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=e[r];this.addEventListener.apply(this,["once",t].concat(o))}},{key:"last",value:function(t){var e=arguments;this.off(t);for(var n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=e[r];this.on.apply(this,[t].concat(o))}},{key:"first",value:function(t){var e=arguments;if(this.source.__events__[t]||0===this.source.__events__[t].length){for(var n=arguments.length,o=new Array(1<n?n-1:0),r=1;r<n;r++)o[r-1]=e[r];this.on.apply(this,[t].concat(o))}else{var i="".concat(t,"只执行触发一次绑定");a(i)}}},{key:"emit",value:function(t,e){var n=(this.store[t]||{}).eventName,o=void 0===n?t:n;if("_error_"!==o&&"string"==typeof e)try{e=JSON.parse(e)||{}}catch(t){a("Native端返回格式错误: ".concat(e))}if("object"!==u(e)||void 0!==e.status)switch(o){case"_ready_":if(this.initCount++,1===this.initCount)c(o,e),this.waitEmit.forEach(function(t,e){return t()}),this.waitEmit=[];else{var r="_ready_ 事件, 只允许初始化一次";c(o,{status:0,msg:r}),a(r)}break;case"_error_":a(e);default:this.source.emit(o,e)}else a("Native端返回格式错误: ".concat(e))}},{key:"off",value:function(t){this.source.off(t)}}])&&r(e.prototype,n),o&&r(e,o),t}())});
